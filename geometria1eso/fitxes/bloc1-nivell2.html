<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rectes i Angles Â· Nivell 2</title>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    :root {
      --paper:  #faf6ee;
      --paper2: #f3ede0;
      --grid:   rgba(180,195,220,0.45);
      --margin: #e8b4b8;
      --ink:    #2a2035;
      --ink2:   #3d3050;
      --red:    #c0392b;
      --green:  #1a7a4a;
      --blue:   #1a4a8a;
      --pencil: #7a6e60;
      --hole:   #d4c8b8;
      --radius: 4px;
      --shadow: 4px 4px 0px rgba(80,60,40,0.15);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #d8cfc4;
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 31px, rgba(140,120,100,0.12) 31px, rgba(140,120,100,0.12) 32px),
        repeating-linear-gradient(90deg, transparent, transparent 31px, rgba(140,120,100,0.08) 31px, rgba(140,120,100,0.08) 32px);
      min-height: 100vh;
      font-family: 'Patrick Hand', cursive;
      color: var(--ink);
      padding: 2rem 1rem 5rem;
    }

    .page-wrap { max-width: 820px; margin: 0 auto; position: relative; }

    /* â”€â”€ PAPER SHEET â”€â”€ */
    .paper-sheet {
      background: var(--paper);
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 31px, var(--grid) 31px, var(--grid) 32px),
        repeating-linear-gradient(90deg, transparent, transparent 31px, var(--grid) 31px, var(--grid) 32px),
        linear-gradient(90deg, transparent 59px, var(--margin) 59px, var(--margin) 61px, transparent 61px);
      border-radius: 2px;
      box-shadow: 3px 3px 0 #c4b9aa, 6px 6px 0 #b8aa99, 9px 9px 0 rgba(100,80,60,0.1);
      padding: 2rem 2.5rem 2.5rem 4.5rem;
      position: relative;
      overflow: hidden;
    }
    .paper-sheet::before {
      content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 40px;
      background: repeating-linear-gradient(to bottom, transparent, transparent 48px, var(--hole) 48px, var(--hole) 68px);
      z-index: 2;
    }
    .paper-sheet::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3rem;
      background: linear-gradient(to bottom, rgba(200,190,175,0.3), transparent);
    }
    .holes {
      position: absolute; left: 13px; top: 0; bottom: 0;
      display: flex; flex-direction: column; justify-content: space-around;
      padding: 40px 0; z-index: 3; pointer-events: none;
    }
    .hole {
      width: 16px; height: 16px; border-radius: 50%;
      background: #d8cfc4; border: 2px solid #bfb3a4;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }

    /* â”€â”€ NAME SCREEN â”€â”€ */
    #nameScreen {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; padding: 3rem 1rem 2rem;
      animation: fadeIn 0.5s ease;
    }
    .name-card {
      background: var(--paper);
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 31px, var(--grid) 31px, var(--grid) 32px);
      border: 2.5px solid var(--ink2);
      border-radius: 4px; padding: 2.5rem 2.5rem 2rem;
      max-width: 420px; width: 100%;
      box-shadow: 6px 6px 0 rgba(50,40,30,0.25);
      transform: rotate(-0.5deg);
      text-align: center;
    }
    .name-title {
      font-family: 'Caveat', cursive; font-size: 2rem; font-weight: 700;
      color: var(--ink); margin-bottom: 0.3rem;
    }
    .name-subtitle {
      font-family: 'Patrick Hand', cursive; font-size: 0.9rem;
      color: var(--pencil); margin-bottom: 1.8rem; line-height: 1.5;
    }
    .name-label {
      font-family: 'Caveat', cursive; font-size: 1rem; font-weight: 700;
      color: var(--blue); text-align: left; display: block; margin-bottom: 0.4rem;
    }
    #playerNameInput {
      width: 100%; background: transparent; border: none;
      border-bottom: 2.5px solid var(--ink); outline: none;
      font-family: 'Caveat', cursive; font-size: 1.4rem; font-weight: 600;
      color: var(--ink); padding: 0.3rem 0.4rem; text-align: center;
      margin-bottom: 1.8rem;
    }
    #playerNameInput::placeholder { color: #c8bfb0; font-size: 1.2rem; }
    #playerNameInput:focus { border-bottom-color: var(--blue); }
    #startBtn {
      font-family: 'Caveat', cursive; font-size: 1.2rem; font-weight: 700;
      background: var(--blue); color: #fff; border: none;
      padding: 0.7rem 2.2rem; border-radius: var(--radius);
      cursor: pointer; box-shadow: var(--shadow);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    #startBtn:hover { transform: translate(-1px,-1px); box-shadow: 5px 5px 0 rgba(80,60,40,0.2); }

    /* â”€â”€ MAIN CONTENT â”€â”€ */
    #mainContent { display: none; }
    #mainContent.show { display: block; animation: fadeIn 0.4s ease; }

    /* â”€â”€ HEADER â”€â”€ */
    .nb-header {
      position: relative; margin-bottom: 2rem; padding-bottom: 1rem;
      border-bottom: 2.5px solid var(--margin);
      animation: fadeIn 0.5s ease both;
    }
    .nb-subject {
      font-family: 'Caveat', cursive; font-size: 0.85rem; font-weight: 700;
      color: var(--blue); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.3rem;
    }
    .nb-title {
      font-family: 'Caveat', cursive; font-size: clamp(2rem, 6vw, 3.2rem);
      font-weight: 700; line-height: 1; color: var(--ink);
    }
    .nb-title span { color: var(--blue); }
    .nb-student {
      font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 600;
      color: var(--pencil); margin-top: 0.3rem;
    }
    .nb-student em { color: var(--ink); font-style: normal; font-weight: 700; }
    .nb-subtitle {
      font-family: 'Patrick Hand', cursive; font-size: 0.9rem;
      color: var(--pencil); margin-top: 0.2rem;
    }

    /* â”€â”€ STAMP â”€â”€ */
    .stamp {
      position: absolute; top: 0; right: 0;
      width: 90px; height: 90px;
      border: 3px solid var(--red); border-radius: 50%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      color: var(--red); transform: rotate(12deg);
      font-family: 'Caveat', cursive; font-weight: 700;
      opacity: 0.75; line-height: 1.1;
      text-transform: uppercase; letter-spacing: 0.04em;
    }
    .stamp-label { font-size: 0.6rem; margin-bottom: 1px; }
    .stamp-score { display: flex; align-items: baseline; gap: 1px; }
    .stamp-num   { font-size: 2.4rem; font-weight: 700; line-height: 1; transition: all 0.3s ease; }
    .stamp-denom { font-size: 1rem; font-weight: 700; opacity: 0.7; }
    @keyframes stampBump { 0%{transform:rotate(12deg) scale(1)} 40%{transform:rotate(10deg) scale(1.25)} 100%{transform:rotate(12deg) scale(1)} }
    .stamp.bump { animation: stampBump 0.4s ease; }

    /* â”€â”€ PROGRESS DOTS â”€â”€ */
    .progress-box {
      background: var(--paper2); border: 1.5px dashed var(--pencil);
      border-radius: var(--radius); padding: 0.8rem 1rem;
      margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem;
      animation: fadeIn 0.5s 0.1s ease both;
    }
    .progress-label {
      font-family: 'Caveat', cursive; font-size: 0.9rem; font-weight: 700;
      color: var(--pencil); white-space: nowrap; min-width: 90px;
    }
    #dotsGrid { display: flex; flex-wrap: wrap; gap: 6px; flex: 1; }
    .dot-ball {
      width: 18px; height: 18px; border-radius: 50%;
      background: transparent; border: 2px solid #bfb3a4;
      transition: all 0.3s ease; position: relative;
    }
    .dot-ball.done {
      background: var(--green); border-color: var(--green);
      box-shadow: 0 0 0 2px rgba(26,122,74,0.2);
    }
    .dot-ball.done::after {
      content: 'âœ“'; position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; color: #fff; font-weight: 700;
    }
    .dot-ball.pop { animation: popDot 0.35s ease; }
    #progressCount {
      font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 700;
      color: var(--blue); white-space: nowrap;
    }

    /* â”€â”€ INSTRUCTIONS â”€â”€ */
    .instructions-box {
      background: #fff9e6; border: 1.5px solid #f0d070;
      border-left: 4px solid #e8a820; border-radius: var(--radius);
      padding: 0.9rem 1.1rem; margin-bottom: 1.8rem;
      font-size: 0.93rem; color: #6a5a30; line-height: 1.6;
      animation: fadeIn 0.5s 0.15s ease both;
    }
    .instructions-box strong { color: #8a6020; }

    /* â”€â”€ ROUND LABEL â”€â”€ */
    #roundLabel {
      font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 700;
      color: var(--pencil); margin-bottom: 0.8rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    #roundLabel::before { content: 'â†’'; color: var(--red); font-size: 1.2rem; }

    /* â”€â”€ CARDS â”€â”€ */
    .exercises { display: flex; flex-direction: column; gap: 1.6rem; }
    .card {
      position: relative; background: transparent;
      border-left: 3px solid var(--blue);
      padding: 1rem 1.2rem 1rem 1.4rem;
      transition: border-color 0.3s;
    }
    .card.correct { border-left-color: var(--green); }
    .card.wrong   { border-left-color: var(--red); }

    .card-num {
      position: absolute; top: -6px; left: -14px;
      width: 24px; height: 24px; border-radius: 50%;
      background: var(--blue); color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Caveat', cursive; font-size: 0.85rem; font-weight: 700;
      box-shadow: var(--shadow); transition: background 0.3s;
    }
    .card.correct .card-num { background: var(--green); }
    .card.wrong   .card-num { background: var(--red); }

    .card-tag {
      display: inline-block; font-family: 'Caveat', cursive;
      font-size: 0.75rem; font-weight: 700; letter-spacing: 0.06em;
      text-transform: uppercase; color: var(--blue);
      border-bottom: 2px dotted currentColor;
      margin-bottom: 0.6rem; padding-bottom: 1px;
    }
    .card.wrong   .card-tag { color: var(--red); }
    .card.correct .card-tag { color: var(--green); }
    .card-difficulty { float: right; font-size: 0.75rem; color: #c8a030; margin-top: 1px; }

    .sentence {
      font-family: 'Patrick Hand', cursive; font-size: 1.05rem;
      line-height: 1.9; color: var(--ink); margin-bottom: 0.5rem;
    }

    /* context block for problems */
    .problem-ctx {
      font-family: 'Patrick Hand', cursive; font-size: 0.93rem;
      color: #4a3f6b; background: rgba(26,74,138,0.06);
      border-left: 3px solid var(--blue); border-radius: 0 4px 4px 0;
      padding: 0.5rem 0.8rem; margin-bottom: 0.7rem; line-height: 1.6;
    }

    input[type="text"] {
      display: inline-block; width: 76px;
      background: transparent; border: none;
      border-bottom: 2.5px solid var(--ink);
      color: var(--blue); font-family: 'Caveat', cursive;
      font-size: 1.1rem; font-weight: 600; text-align: center;
      padding: 0.1rem 0.3rem; outline: none;
      transition: border-color 0.2s; vertical-align: baseline;
    }
    input[type="text"]::placeholder { color: #bfb3a4; font-size: 1rem; }
    input[type="text"]:focus { border-bottom-color: var(--blue); }
    input.correct-input { border-bottom-color: var(--green); color: var(--green); }
    input.wrong-input   { border-bottom-color: var(--red);   color: var(--red);   }
    input:disabled { opacity: 0.85; cursor: default; }

    .hint {
      font-family: 'Caveat', cursive; font-size: 0.95rem; font-weight: 600;
      color: var(--pencil); background: rgba(180,160,120,0.08);
      border: 1.5px dashed var(--pencil); border-radius: var(--radius);
      padding: 0; margin-top: 0.5rem;
      max-height: 0; overflow: hidden; opacity: 0;
      transition: max-height 0.35s ease, opacity 0.35s ease, padding 0.35s ease;
    }
    .hint.visible { max-height: 160px; opacity: 1; padding: 0.45rem 0.8rem; }
    .hint::before { content: 'ğŸ“ '; }

    .feedback {
      font-family: 'Caveat', cursive; font-size: 1rem; font-weight: 700;
      margin-top: 0.5rem; min-height: 1.4rem;
      opacity: 0; transform: translateY(4px);
      transition: opacity 0.25s, transform 0.25s;
    }
    .feedback.show { opacity: 1; transform: translateY(0); }
    .feedback.ok   { color: var(--green); }
    .feedback.err  { color: var(--red); }

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn-row { margin-top: 2rem; display: flex; flex-direction: column; align-items: flex-start; gap: 0.7rem; }

    #checkBtn {
      font-family: 'Caveat', cursive; font-size: 1.2rem; font-weight: 700;
      background: var(--blue); color: #fff; border: none;
      padding: 0.65rem 2rem; border-radius: var(--radius);
      cursor: pointer; box-shadow: var(--shadow);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    #checkBtn::before { content: 'âœï¸ '; }
    #checkBtn:hover  { transform: translate(-1px,-1px); box-shadow: 5px 5px 0 rgba(80,60,40,0.2); }
    #checkBtn:active { transform: translate(2px,2px); box-shadow: 1px 1px 0 rgba(80,60,40,0.15); }
    #checkBtn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: var(--shadow); }

    #retryBtn {
      display: none; font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 700;
      background: transparent; color: var(--pencil);
      border: 2px dashed var(--pencil); padding: 0.55rem 1.6rem;
      border-radius: var(--radius); cursor: pointer;
      transition: color 0.2s, border-color 0.2s;
    }
    #retryBtn::before { content: 'â†º '; }
    #retryBtn:hover { color: var(--red); border-color: var(--red); }

    #scoreBox {
      margin-top: 1rem; font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 700;
      opacity: 0; transform: translateY(8px); transition: opacity 0.35s, transform 0.35s;
    }
    #scoreBox.show { opacity: 1; transform: translateY(0); }
    #scoreBox .score-num { font-size: 2rem; color: var(--blue); display: block; line-height: 1; }
    #scoreBox .score-msg { color: var(--pencil); font-size: 1rem; }

    /* â”€â”€ CELEBRATION â”€â”€ */
    #celebration {
      display: none; position: fixed; inset: 0; z-index: 999;
      background: rgba(50,40,30,0.75);
      justify-content: center; align-items: center;
    }
    #celebration.show { display: flex; animation: fadeIn 0.3s ease; }
    .celeb-paper {
      background: var(--paper);
      background-image: repeating-linear-gradient(0deg, transparent, transparent 31px, var(--grid) 31px, var(--grid) 32px);
      border: 3px solid var(--ink2); border-radius: 4px;
      padding: 2rem 2.5rem 2rem; max-width: 420px; width: 90%;
      text-align: center; box-shadow: 8px 8px 0 rgba(50,40,30,0.35);
      transform: rotate(-1.5deg); position: relative;
    }
    .celeb-paper::before {
      content: 'â­'; position: absolute; top: -18px; left: 50%;
      transform: translateX(-50%); font-size: 2.2rem;
    }
    .celeb-name   { font-family: 'Caveat', cursive; font-size: 1rem; font-weight: 600; color: var(--pencil); margin-bottom: 0.2rem; }
    .celeb-title  { font-family: 'Caveat', cursive; font-size: 2.2rem; font-weight: 700; color: var(--ink); margin-bottom: 0.3rem; }
    .celeb-stamp  {
      display: inline-block; border: 3px solid var(--red); border-radius: 4px;
      color: var(--red); font-family: 'Caveat', cursive;
      font-size: 1.5rem; font-weight: 700;
      padding: 0.2rem 1rem; margin: 0.6rem 0 0.4rem;
      transform: rotate(-3deg);
    }
    .celeb-score-note { font-family: 'Patrick Hand', cursive; font-size: 0.82rem; color: var(--pencil); margin-bottom: 0.2rem; }
    .celeb-score-note.bonus { color: var(--green); font-weight: 700; }
    .celeb-sub    { font-family: 'Patrick Hand', cursive; font-size: 0.92rem; color: var(--pencil); margin: 0.8rem 0 1.3rem; line-height: 1.5; }
    #celebCloseBtn {
      font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 700;
      background: var(--ink); color: #fff; border: none;
      padding: 0.65rem 2rem; border-radius: var(--radius);
      cursor: pointer; box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
      transition: transform 0.12s;
    }
    #celebCloseBtn:hover { transform: translate(-1px,-1px); }

    /* â”€â”€ CONFETTI â”€â”€ */
    #confettiCanvas { position: fixed; inset: 0; z-index: 998; pointer-events: none; display: none; }
    #confettiCanvas.show { display: block; }

    /* â”€â”€ FINAL SCREEN â”€â”€ */
    #finalScreen { display: none; text-align: center; padding: 3rem 1rem; }
    #finalScreen.show { display: block; animation: fadeIn 0.6s ease; }
    .final-wrap {
      display: inline-block; background: var(--paper);
      border: 3px solid var(--ink); border-radius: 4px;
      padding: 3rem 3rem 2.5rem;
      box-shadow: 8px 8px 0 rgba(50,40,30,0.3); transform: rotate(0.5deg);
    }
    .final-name  { font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 600; color: var(--pencil); margin-bottom: 0.5rem; }
    .final-grade {
      font-family: 'Caveat', cursive; font-size: 4.5rem; font-weight: 700;
      color: var(--red); line-height: 1;
      border: 4px solid var(--red); border-radius: 50%;
      width: 110px; height: 110px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      margin: 0 auto 0.8rem; transform: rotate(-5deg);
    }
    .final-grade .grade-num   { font-size: 3.2rem; line-height: 1; }
    .final-grade .grade-denom { font-size: 1rem; opacity: 0.6; line-height: 1; }
    .final-title { font-family: 'Caveat', cursive; font-size: 2rem; font-weight: 700; color: var(--ink); }
    .final-sub   { font-family: 'Patrick Hand', cursive; font-size: 0.95rem; color: var(--pencil); margin: 0.5rem 0 1.5rem; line-height: 1.6; }
    .final-note  { font-family: 'Caveat', cursive; font-size: 0.85rem; color: var(--pencil); margin-bottom: 1.2rem; font-style: italic; }
    #reloadBtn {
      font-family: 'Caveat', cursive; font-size: 1.1rem; font-weight: 700;
      background: var(--ink); color: #fff; border: none;
      padding: 0.65rem 2rem; border-radius: var(--radius);
      cursor: pointer; box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
    }
    #reloadBtn:hover { background: var(--blue); }

    /* â”€â”€ KEYFRAMES â”€â”€ */
    @keyframes fadeIn    { from{opacity:0} to{opacity:1} }
    @keyframes slideIn   { from{opacity:0;transform:translateX(-12px)} to{opacity:1;transform:translateX(0)} }
    @keyframes popDot    { 0%{transform:scale(1)} 50%{transform:scale(1.5)} 100%{transform:scale(1)} }
  </style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- Celebration overlay -->
<div id="celebration">
  <div class="celeb-paper">
    <div class="celeb-name" id="celebName"></div>
    <div class="celeb-title">Molt bÃ©! ğŸ‰</div>
    <div class="celeb-stamp">3 / 3 âœ“</div>
    <div class="celeb-score-note bonus" id="celebScoreNote"></div>
    <div class="celeb-sub" id="celebSub"></div>
    <button id="celebCloseBtn" onclick="nextRound()">Seguim â†’</button>
  </div>
</div>

<div class="page-wrap">

  <!-- â”€â”€ NAME SCREEN â”€â”€ -->
  <div id="nameScreen">
    <div class="name-card">
      <div class="name-title">ğŸ“ Rectes i Angles II</div>
      <div class="name-subtitle">MatemÃ tiques Â· 1r ESO<br>Geometria avanÃ§ada: angles, figures i problemes</div>
      <label class="name-label" for="playerNameInput">âœï¸ Escriu el teu nom per comenÃ§ar:</label>
      <input type="text" id="playerNameInput" placeholder="El teu nom aquÃ­â€¦" maxlength="30" autocomplete="off">
      <button id="startBtn" onclick="startGame()">Comencem! â†’</button>
    </div>
  </div>

  <!-- â”€â”€ MAIN CONTENT â”€â”€ -->
  <div id="mainContent">
  <div class="paper-sheet">

    <div class="holes">
      <div class="hole"></div><div class="hole"></div><div class="hole"></div>
      <div class="hole"></div><div class="hole"></div><div class="hole"></div>
      <div class="hole"></div><div class="hole"></div><div class="hole"></div>
      <div class="hole"></div><div class="hole"></div><div class="hole"></div>
    </div>

    <!-- Header -->
    <div class="nb-header">
      <div class="nb-subject">MatemÃ tiques Â· 1r ESO</div>
      <div class="nb-title">Rectes i <span>Angles II</span></div>
      <div class="nb-student">Alumne/a: <em id="headerName"></em></div>
      <div class="nb-subtitle">Angles, figures geomÃ¨triques i problemes aplicats</div>
      <div class="stamp">
        <div class="stamp-label">Nota</div>
        <div class="stamp-score">
          <div class="stamp-num" id="stampNum">0</div>
          <div class="stamp-denom">/30</div>
        </div>
      </div>
    </div>

    <!-- Progress dots -->
    <div class="progress-box">
      <div class="progress-label">Exercicis âœ“</div>
      <div id="dotsGrid"></div>
      <div id="progressCount">0 / 30</div>
    </div>

    <!-- Instructions -->
    <div class="instructions-box">
      ğŸ’¡ Omple els buits i fes clic a <strong>"Comprova"</strong>. Si t'equivoques apareixerÃ  una pista, perÃ² <strong>la resposta no et serÃ  donada</strong>. Cada pregunta encertada a la primera suma <strong>1 punt</strong>. Pots reintentar les que has fallat sense perdre els encerts!
    </div>

    <!-- Round + exercises -->
    <div id="roundLabel"></div>
    <div class="exercises" id="exercises"></div>

    <!-- Buttons -->
    <div class="btn-row">
      <button id="checkBtn" onclick="checkAnswers()">Comprova respostes</button>
      <div id="scoreBox">
        <span class="score-num" id="scoreNum"></span>
        <span class="score-msg" id="scoreMsg"></span>
      </div>
      <button id="retryBtn" onclick="retryRound()">Torna-ho a intentar</button>
    </div>

    <!-- Final screen -->
    <div id="finalScreen">
      <div class="final-wrap">
        <div class="final-name" id="finalName"></div>
        <div class="final-grade">
          <div class="grade-num" id="finalGradeNum">â€”</div>
          <div class="grade-denom">/ 30</div>
        </div>
        <div class="final-title" id="finalTitle">ExcelÂ·lent!</div>
        <div class="final-sub" id="finalSub"></div>
        <div class="final-note">* Cada pregunta encertada a la primera suma 1 punt. MÃ xim: 30 punts.</div>
        <button id="reloadBtn" onclick="location.reload()">Tornar a comenÃ§ar</button>
      </div>
    </div>

  </div><!-- /paper-sheet -->
  </div><!-- /mainContent -->

</div><!-- /page-wrap -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BANK â€” 30 exercicis  Â·  Rectes i Angles II  Â·  1r ESO
//   s[]  â†’ string = text pla | ['x'] = negreta | '_' = input
//   ctx  â†’ (opcional) text de context del problema (string)
//   stars: 1=â˜…  2=â˜…â˜…  3=â˜…â˜…â˜…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BANK = [

  // â”€â”€ Angles formats per rectes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Angles i rectes", stars:1,
    s:['Dues rectes es tallen formant 4 angles. Si un angle mesura 70Â°, el seu adjacent (suplementari) mesura ','_','Â°.'],
    answer:110,
    hint:"Angles suplementaris sumen 180Â°. â†’ 180 âˆ’ 70."
  },
  {
    tag:"Angles i rectes", stars:1,
    s:['Dues rectes perpendiculars es tallen formant 4 angles rectes. Cada angle mesura ','_','Â°.'],
    answer:90,
    hint:"Perpendicular = 90Â°. Els 4 angles formats valen 90Â° cadascun."
  },
  {
    tag:"Angles i rectes", stars:2,
    s:['Una secant talla dues rectes paralÂ·leles. Un angle intern co-interior (entre les paralÂ·leles, al mateix costat de la secant) mesura 65Â°. L\'altre angle co-interior mesura ','_','Â°.'],
    answer:115,
    hint:"Els angles co-interiors (conjugats) entre rectes paralÂ·leles sumen 180Â°. â†’ 180 âˆ’ 65."
  },
  {
    tag:"Angles i rectes", stars:2,
    s:['Una secant talla dues paralÂ·leles. Un angle altern intern mesura 48Â°. L\'altern intern del costat oposat mesura ','_','Â°.'],
    answer:48,
    hint:"Els angles alterns interns entre rectes paralÂ·leles sÃ³n iguals."
  },
  {
    tag:"Angles i rectes", stars:2,
    s:['Dues rectes es tallen. Un dels quatre angles mesura 130Â°. L\'angle oposat pel vÃ¨rtex mesura ','_','Â° i cadascun dels adjacents mesura ','_','Â°.'],
    answer:130,
    hint:"Oposats pel vÃ¨rtex: iguals. Adjacent (suplementari): 180 âˆ’ 130 = 50Â°. Escriu la resposta de l'oposat pel vÃ¨rtex."
  },

  // â”€â”€ Bisectriu i mediatriu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Bisectriu", stars:1,
    s:['La bisectriu d\'un angle el divideix en dues parts iguals. Si l\'angle mesura 80Â°, cada meitat mesura ','_','Â°.'],
    answer:40,
    hint:"Bisectriu = divideix per la meitat. â†’ 80 Ã· 2."
  },
  {
    tag:"Bisectriu", stars:2,
    s:['La bisectriu d\'un angle recte forma dos angles de ','_','Â° cadascun.'],
    answer:45,
    hint:"Angle recte = 90Â°. Bisectriu: 90 Ã· 2."
  },
  {
    tag:"Mediatriu", stars:1,
    s:['La mediatriu d\'un segment de ','_',' cm el talla perpendicularment pel punt mig. Si el segment mesura 14 cm, cada meitat mesura ','_','Â°... Ã©s a dir, ','_',' cm.'],
    answer:7,
    hint:"El punt mig divideix el segment en dues parts iguals: 14 Ã· 2."
  },
  {
    tag:"Mediatriu", stars:2,
    s:['Tots els punts de la mediatriu d\'un segment estan a la mateixa distÃ ncia dels dos extrems. Si l\'extrem A Ã©s a 9 cm d\'un punt de la mediatriu, l\'extrem B Ã©s a ','_',' cm del mateix punt.'],
    answer:9,
    hint:"La propietat de la mediatriu: qualsevol punt equidista dels dos extrems."
  },

  // â”€â”€ Angles en triangles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Angles triangle", stars:1,
    s:['En un triangle, dos angles mesuren 55Â° i 75Â°. El tercer angle mesura ','_','Â°.'],
    answer:50,
    hint:"Suma dels angles = 180Â°. â†’ 180 âˆ’ 55 âˆ’ 75."
  },
  {
    tag:"Angles triangle", stars:2,
    s:['En un triangle isÃ²sceles, l\'angle del vÃ¨rtex mesura 100Â°. Cada angle de la base mesura ','_','Â°.'],
    answer:40,
    hint:"180 âˆ’ 100 = 80Â°. Els dos angles de la base sÃ³n iguals: 80 Ã· 2."
  },
  {
    tag:"Angles triangle", stars:2,
    s:['En un triangle rectangle, un angle agut Ã©s el doble de l\'altre. L\'angle menor mesura ','_','Â°.'],
    answer:30,
    hint:"Els dos angles aguts sumen 90Â°. Si un Ã©s x i l'altre 2x: x + 2x = 90 â†’ x = 30."
  },
  {
    tag:"Angles triangle", stars:3,
    s:['L\'angle exterior d\'un triangle Ã©s igual a la suma dels dos angles interiors no adjacents. Un angle exterior mesura 115Â°. Un dels angles interiors no adjacents Ã©s 60Â°. L\'altre Ã©s ','_','Â°.'],
    answer:55,
    hint:"Angle exterior = suma dels 2 interiors no adjacents. â†’ 115 âˆ’ 60."
  },
  {
    tag:"Angles triangle", stars:3,
    ctx:"En un triangle, els angles estan en proporciÃ³ 1 : 2 : 3.",
    s:['L\'angle menor mesura ','_','Â°, el mitjÃ  ','_','Â°, i el major ','_','Â°.'],
    answer:30,
    hint:"La suma Ã©s 180Â°, i els angles estan en proporciÃ³ 1:2:3. â†’ 180 Ã· 6 = 30Â°. Els altres: 60Â° i 90Â°. Escriu el valor del menor."
  },

  // â”€â”€ Angles en quadrilÃ ters i polÃ­gons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"PolÃ­gons", stars:1,
    s:['En un rectangle, tots els angles mesuren ','_','Â°.'],
    answer:90,
    hint:"Un rectangle tÃ© 4 angles rectes de 90Â°."
  },
  {
    tag:"PolÃ­gons", stars:2,
    s:['En un paralÂ·lelogram, dos angles consecutius sumen ','_','Â°. Si un angle mesura 70Â°, el consecutiu mesura ','_','Â°.'],
    answer:110,
    hint:"En un paralÂ·lelogram, angles consecutius son suplementaris: sumen 180Â°. â†’ 180 âˆ’ 70."
  },
  {
    tag:"PolÃ­gons", stars:2,
    s:['En un rombe, dos angles oposats mesuren 60Â° cadascun. Els altres dos angles oposats mesuren ','_','Â° cadascun.'],
    answer:120,
    hint:"Suma total = 360Â°. Ja tenim 60 + 60 = 120Â°. Resten 360 âˆ’ 120 = 240Â° per als altres dos, iguals: 240 Ã· 2."
  },
  {
    tag:"PolÃ­gons", stars:2,
    s:['La suma dels angles interiors d\'un heptÃ gon (7 costats) Ã©s ','_','Â°.'],
    answer:900,
    hint:"FÃ³rmula: (n âˆ’ 2) Ã— 180Â°. â†’ (7 âˆ’ 2) Ã— 180."
  },
  {
    tag:"PolÃ­gons", stars:3,
    s:['En un octÃ gon regular (8 costats), cada angle interior mesura ','_','Â°.'],
    answer:135,
    hint:"Suma = (8 âˆ’ 2) Ã— 180 = 1080Â°. Cada angle: 1080 Ã· 8."
  },
  {
    tag:"PolÃ­gons", stars:3,
    s:['Un polÃ­gon regular tÃ© cada angle interior de 144Â°. Quants costats tÃ©? ','_',' costats.'],
    answer:10,
    hint:"Cada angle interior = (nâˆ’2)Ã—180 Ã· n. Planteja (nâˆ’2)Ã—180 = 144n i resol: 180n âˆ’ 360 = 144n â†’ 36n = 360 â†’ n = 10."
  },

  // â”€â”€ Problemes aplicats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Problema", stars:2,
    ctx:"Un rellotge analÃ²gic marca les 3 en punt.",
    s:['L\'angle format per les agulles del rellotge Ã©s de ','_','Â°.'],
    answer:90,
    hint:"A les 3 en punt, les agulles formen un angle recte. La circumferÃ¨ncia (360Â°) dividida en 12 hores: 360 Ã· 12 = 30Â° per hora. De les 12 a les 3 hi ha 3 hores: 3 Ã— 30 = 90Â°."
  },
  {
    tag:"Problema", stars:2,
    ctx:"Un rellotge analÃ²gic marca les 6 en punt.",
    s:['L\'angle format per les agulles del rellotge Ã©s de ','_','Â°.'],
    answer:180,
    hint:"A les 6, les dues agulles formen una lÃ­nia recta (angle pla). 6 Ã— 30Â° = 180Â°."
  },
  {
    tag:"Problema", stars:3,
    ctx:"En una cruÃ¯lla, tres carrers es troben en un punt. Els angles que formen entre ells estan en proporciÃ³ 2 : 3 : 7.",
    s:['L\'angle major de la cruÃ¯lla mesura ','_','Â°.'],
    answer:210,
    hint:"Els tres angles sumen 360Â°. En proporciÃ³ 2:3:7, la suma de parts = 12. Cada part = 360 Ã· 12 = 30Â°. L'angle major = 7 Ã— 30Â°."
  },
  {
    tag:"Problema", stars:3,
    ctx:"Una escala forma un angle de 65Â° amb el terra horitzontal.",
    s:['L\'angle que forma l\'escala amb la paret vertical Ã©s de ','_','Â°.'],
    answer:25,
    hint:"L'escala, la paret i el terra formen un triangle rectangle. Els dos angles aguts han de sumar 90Â°. â†’ 90 âˆ’ 65."
  },
  {
    tag:"Problema", stars:3,
    ctx:"Tres rectes concurrents passen per un mateix punt. Formen 6 angles al voltant del punt.",
    s:['Si els sis angles sÃ³n iguals, cada un mesura ','_','Â°.'],
    answer:60,
    hint:"Tres rectes que es tallen en un punt formen 6 angles. La suma total Ã©s 360Â°. â†’ 360 Ã· 6."
  },
  {
    tag:"Problema", stars:3,
    ctx:"En un triangle ABC, la bisectriu de l'angle A talla BC en el punt D. L'angle A mesura 80Â° i l'angle B mesura 50Â°.",
    s:['L\'angle C del triangle mesura ','_','Â°. L\'angle que forma la bisectriu AD amb el costat AB mesura ','_','Â°.'],
    answer:50,
    hint:"Angle C = 180 âˆ’ 80 âˆ’ 50 = 50Â°. La bisectriu de A divideix l'angle A per la meitat: 80 Ã· 2 = 40Â°. Escriu el valor de l'angle C."
  },
  {
    tag:"Problema", stars:2,
    ctx:"Un terreny tÃ© forma de trapezi. Els angles de la base inferior mesuren 70Â° i 80Â°.",
    s:['La suma dels dos angles de la base inferior Ã©s ','_','Â°. Els angles de la base superior, que son suplementaris dels de la base inferior respectivament, sumen ','_','Â°. Escriu la suma dels angles de la base superior.'],
    answer:210,
    hint:"Cada angle de la base superior Ã©s suplementari al de la base inferior: 180âˆ’70=110Â° i 180âˆ’80=100Â°. Suma: 110+100 = 210Â°."
  },
  {
    tag:"Problema", stars:3,
    ctx:"Un romb tÃ© un angle de 60Â°. Les diagonals d'un rombe es tallen perpendicularment i bisecten els angles.",
    s:['Cada diagonal bisecta l\'angle de 60Â°, formant triangles de ','_','Â° en aquell vÃ¨rtex.'],
    answer:30,
    hint:"La diagonal bisecta l'angle de 60Â°: 60 Ã· 2 = 30Â°."
  },
  {
    tag:"Problema", stars:3,
    ctx:"Una torre de rÃ dio Ã©s perpendicular al terra. Des d'un punt del terra, el cable tensor forma un angle de 35Â° amb la torre.",
    s:['L\'angle que forma el cable tensor amb el terra Ã©s de ','_','Â°.'],
    answer:55,
    hint:"La torre, el terra i el cable formen un triangle rectangle. L'angle a la base de la torre Ã©s 90Â°. Els dos angles aguts sumen 90Â°: 90 âˆ’ 35."
  },
  {
    tag:"Problema", stars:3,
    ctx:"En una figura, dues rectes paralÂ·leles r i s estan tallades per una secant t. L'angle que t forma amb r en la intersecciÃ³ Ã©s de 40Â° (angle agut).",
    s:['L\'angle altern extern format amb s Ã©s de ','_','Â°, i l\'angle co-interior (entre les paralÂ·leles, mateix costat) amb s Ã©s de ','_','Â°. Escriu l\'angle altern extern.'],
    answer:40,
    hint:"Altern extern = igual que l'angle original (rectes paralÂ·leles). Co-interior = suplementari (180âˆ’40=140Â°). Escriu el valor de l'altern extern."
  },
  {
    tag:"Problema", stars:3,
    ctx:"Un polÃ­gon convex tÃ© 9 costats (nonÃ gon).",
    s:['La suma dels seus angles interiors Ã©s ','_','Â°. Si fos regular, cada angle interior mesuraria ','_','Â°. Escriu la suma dels angles interiors.'],
    answer:1260,
    hint:"FÃ³rmula: (nâˆ’2) Ã— 180Â° = (9âˆ’2) Ã— 180 = 7 Ã— 180 = 1260Â°. Cada angle si fos regular: 1260 Ã· 9 = 140Â°."
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TOTAL = 30, PER = 3;
let order = [], solved = 0, score = 0, roundIdx = 0;
let currentEx = [], checked = false;
let canScore = [true, true, true];
let locked   = [false, false, false];
let playerName = '';
const STARS = ['', 'â˜…', 'â˜…â˜…', 'â˜…â˜…â˜…'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOM I INICI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('playerNameInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') startGame();
});
function startGame() {
  const raw = document.getElementById('playerNameInput').value.trim();
  playerName = raw || 'Alumne/a';
  document.getElementById('nameScreen').style.display = 'none';
  document.getElementById('mainContent').classList.add('show');
  document.getElementById('headerName').textContent = playerName;
  init();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  order = [...Array(TOTAL).keys()];
  for (let i = TOTAL - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [order[i], order[j]] = [order[j], order[i]];
  }
  buildDots();
  loadRound(0, false);
}

function buildDots() {
  const g = document.getElementById('dotsGrid');
  g.innerHTML = '';
  for (let i = 0; i < TOTAL; i++) {
    const d = document.createElement('div');
    d.className = 'dot-ball'; d.id = 'dot' + i;
    g.appendChild(d);
  }
  updateCount();
}

function updateCount() {
  document.getElementById('progressCount').textContent = solved + ' / ' + TOTAL;
  document.getElementById('stampNum').textContent = score;
}

function markDots(indices) {
  indices.forEach((gi, delay) => {
    setTimeout(() => {
      const el = document.getElementById('dot' + gi);
      if (!el) return;
      el.classList.add('done', 'pop');
      el.addEventListener('animationend', () => el.classList.remove('pop'), { once: true });
    }, delay * 180);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARREGAR REPTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadRound(ri, animate) {
  checked  = false;
  canScore = [true, true, true];
  locked   = [false, false, false];
  roundIdx = ri;

  const start = ri * PER;
  currentEx = order.slice(start, start + PER).map(i => BANK[i]);

  document.getElementById('roundLabel').textContent =
    'Repte ' + (ri + 1) + ' de ' + (TOTAL / PER);

  document.getElementById('scoreBox').classList.remove('show');
  document.getElementById('scoreNum').textContent = '';
  document.getElementById('scoreMsg').textContent = '';
  document.getElementById('retryBtn').style.display = 'none';
  document.getElementById('checkBtn').disabled = false;
  document.getElementById('checkBtn').style.display = '';

  const container = document.getElementById('exercises');

  function renderCards() {
    container.innerHTML = '';
    currentEx.forEach((ex, i) => {
      const card = document.createElement('div');
      card.className = 'card'; card.id = 'card' + i;

      let sentHTML = '';
      ex.s.forEach(part => {
        if (part === '_') {
          sentHTML += '<input type="text" id="ans' + i +
            '" placeholder="Â·Â·Â·" autocomplete="off" maxlength="12">';
        } else if (Array.isArray(part)) {
          sentHTML += '<strong>' + part[0] + '</strong>';
        } else {
          sentHTML += part;
        }
      });

      const ctxHTML = ex.ctx
        ? '<div class="problem-ctx">' + ex.ctx + '</div>'
        : '';

      card.innerHTML =
        '<div class="card-num">' + (i + 1) + '</div>' +
        '<div class="card-tag">' + ex.tag +
          '<span class="card-difficulty">' + (STARS[ex.stars || 1]) + '</span>' +
        '</div>' +
        ctxHTML +
        '<div class="sentence">' + sentHTML + '</div>' +
        '<div class="hint" id="hint' + i + '">' + ex.hint + '</div>' +
        '<div class="feedback" id="fb' + i + '"></div>';

      container.appendChild(card);

      card.style.opacity = '0';
      card.style.transform = 'translateX(50px)';
      setTimeout(() => {
        card.style.transition = 'opacity 0.35s ease, transform 0.35s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateX(0)';
      }, 60 + i * 90);
    });

    currentEx.forEach((_, i) => {
      document.getElementById('ans' + i).addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          let next = i + 1;
          while (next < PER && locked[next]) next++;
          const nxt = next < PER ? document.getElementById('ans' + next) : null;
          if (nxt) nxt.focus(); else checkAnswers();
        }
      });
    });

    setTimeout(() => {
      const f = document.getElementById('ans0');
      if (f && !locked[0]) f.focus();
    }, 350);
  }

  if (animate && container.children.length > 0) {
    Array.from(container.children).forEach((card, i) => {
      card.style.transition = 'opacity 0.28s ease, transform 0.28s ease';
      card.style.transitionDelay = (i * 50) + 'ms';
      card.style.opacity = '0';
      card.style.transform = 'translateX(-55px)';
    });
    setTimeout(renderCards, 340);
  } else {
    renderCards();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPROVA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkAnswers() {
  if (checked) return;
  const TOL = 0.5;
  let okThisAttempt = 0;
  let scoreGained   = 0;
  let allDone       = true;

  currentEx.forEach((ex, i) => {
    if (locked[i]) { okThisAttempt++; return; }

    const inp  = document.getElementById('ans'  + i);
    const fb   = document.getElementById('fb'   + i);
    const card = document.getElementById('card' + i);
    const hint = document.getElementById('hint' + i);
    const val  = parseFloat(inp.value.replace(',', '.').replace(/\s/g, ''));

    if (isNaN(val)) {
      inp.classList.remove('correct-input', 'wrong-input');
      card.classList.remove('correct', 'wrong');
      fb.className = 'feedback err show';
      fb.textContent = 'âœ— Escriu un nÃºmero.';
      hint.classList.add('visible');
      allDone = false;
      canScore[i] = false;
      return;
    }

    if (Math.abs(val - ex.answer) <= TOL) {
      okThisAttempt++;
      locked[i] = true;
      inp.classList.add('correct-input'); inp.classList.remove('wrong-input');
      inp.disabled = true;
      card.classList.add('correct'); card.classList.remove('wrong');
      fb.className = 'feedback ok show';
      const bonus = canScore[i] ? ' (+1 punt)' : '';
      fb.textContent = 'âœ“ Correcte!' + bonus;
      hint.classList.remove('visible');
      if (canScore[i]) scoreGained++;
    } else {
      allDone = false;
      canScore[i] = false;
      inp.classList.add('wrong-input'); inp.classList.remove('correct-input');
      card.classList.add('wrong'); card.classList.remove('correct');
      fb.className = 'feedback err show';
      fb.textContent = 'âœ— No Ã©s correcte. Revisa la pista!';
      hint.classList.add('visible');
    }
  });

  if (scoreGained > 0) {
    score += scoreGained;
    updateCount();
    const stamp = document.querySelector('.stamp');
    stamp.classList.remove('bump');
    void stamp.offsetWidth;
    stamp.classList.add('bump');
    stamp.addEventListener('animationend', () => stamp.classList.remove('bump'), { once: true });
  }

  const pendents = PER - okThisAttempt;
  let msg = '';
  if (allDone) {
    msg = 'Perfecte! Totes encertades! ğŸ†';
  } else if (pendents === 1) {
    msg = 'Queda 1 per corregir. Torna-ho a provar! ğŸ’ª';
  } else {
    msg = 'Queden ' + pendents + ' per corregir. Revisa les pistes! ğŸ’ª';
  }
  document.getElementById('scoreNum').textContent = okThisAttempt + ' / ' + PER;
  document.getElementById('scoreMsg').textContent = msg;
  document.getElementById('scoreBox').classList.add('show');

  if (allDone) {
    checked = true;
    document.getElementById('checkBtn').disabled = true;
    for (let i = 0; i < PER; i++) {
      const h = document.getElementById('hint' + i);
      if (h) h.classList.remove('visible');
    }
    const dotStart = roundIdx * PER;
    markDots(order.slice(dotStart, dotStart + PER));
    solved += PER;
    updateCount();
    const isLast = (roundIdx + 1) * PER >= TOTAL;
    if (isLast) setTimeout(showFinal, 800);
    else         setTimeout(showCelebration, 500);
  } else {
    document.getElementById('retryBtn').style.display = '';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RETRY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function retryRound() {
  for (let i = 0; i < PER; i++) {
    if (locked[i]) continue;
    const inp  = document.getElementById('ans'  + i);
    const fb   = document.getElementById('fb'   + i);
    const card = document.getElementById('card' + i);
    if (inp)  { inp.value = ''; inp.classList.remove('correct-input', 'wrong-input'); }
    if (card) card.classList.remove('correct', 'wrong');
    if (fb)   { fb.className = 'feedback'; fb.textContent = ''; }
  }
  document.getElementById('scoreBox').classList.remove('show');
  document.getElementById('retryBtn').style.display = 'none';
  document.getElementById('checkBtn').disabled = false;
  checked = false;
  for (let i = 0; i < PER; i++) {
    if (!locked[i]) { document.getElementById('ans' + i).focus(); break; }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CELEBRACIÃ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showCelebration() {
  document.getElementById('celebName').textContent = playerName + ',';
  document.getElementById('celebSub').textContent =
    'Repte ' + (roundIdx + 1) + ' superat! Prepara\'t per al repte ' + (roundIdx + 2) + '.';
  const noteEl = document.getElementById('celebScoreNote');
  noteEl.textContent = 'Nota acumulada: ' + score + ' / 30';
  noteEl.className = 'celeb-score-note bonus';
  document.getElementById('celebration').classList.add('show');
  launchConfetti();
}
function nextRound() {
  document.getElementById('celebration').classList.remove('show');
  stopConfetti();
  loadRound(roundIdx + 1, true);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FINAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showFinal() {
  document.getElementById('exercises').style.display  = 'none';
  document.getElementById('roundLabel').style.display = 'none';
  document.querySelector('.btn-row').style.display    = 'none';
  document.getElementById('finalName').textContent     = playerName;
  document.getElementById('finalGradeNum').textContent = score;

  const titles = [
    [0,  9,  'Segueix practicant!',     'No t\'amoÃ¯nis, la prÃ ctica fa la perfecciÃ³. Torna a intentar-ho!'],
    [10, 18, 'BÃ©, perÃ² pots millorar!', 'Has superat molts reptes. Amb una mica mÃ©s d\'esforÃ§ arribarÃ s al mÃ xim!'],
    [19, 26, 'Notable!',                'Molt bon treball, ' + playerName + '! Quasi ho tens tot dominat.'],
    [27, 30, 'ExcelÂ·lent! ğŸ…',          'IncreÃ¯ble, ' + playerName + '! Domines els angles i la geometria!'],
  ];
  const [,, title, sub] = titles.find(([mn, mx]) => score >= mn && score <= mx) || titles[3];
  document.getElementById('finalTitle').textContent = title;
  document.getElementById('finalSub').textContent   = sub;
  document.getElementById('finalScreen').classList.add('show');
  launchConfetti();
  setTimeout(stopConfetti, 6000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('confettiCanvas');
const ctx    = canvas.getContext('2d');
let particles = [], confettiAF = null;
function launchConfetti() {
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  canvas.classList.add('show');
  particles = Array.from({ length: 90 }, makeP);
  if (confettiAF) cancelAnimationFrame(confettiAF);
  (function loop() { drawConfetti(); confettiAF = requestAnimationFrame(loop); })();
}
function stopConfetti() {
  if (confettiAF) { cancelAnimationFrame(confettiAF); confettiAF = null; }
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  canvas.classList.remove('show');
}
function makeP() {
  const c = ['#c0392b','#1a4a8a','#1a7a4a','#e8a820','#8a4a8a','#2a8a8a'];
  return {
    x: Math.random() * window.innerWidth, y: Math.random() * -200,
    w: 8 + Math.random() * 8, h: 4 + Math.random() * 5,
    color: c[Math.floor(Math.random() * c.length)],
    speed: 2 + Math.random() * 4, angle: Math.random() * Math.PI * 2,
    spin: (Math.random() - 0.5) * 0.2, drift: (Math.random() - 0.5) * 1.5,
  };
}
function drawConfetti() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    p.y += p.speed; p.x += p.drift; p.angle += p.spin;
    if (p.y > canvas.height) Object.assign(p, makeP(), { y: -20 });
    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.angle);
    ctx.fillStyle = p.color; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();
  });
}
</script>
</body>
</html>
