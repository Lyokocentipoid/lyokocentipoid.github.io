<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rectes i Angles Â· 1r ESO</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Baloo+2:wght@500;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f1923; --card: #1a2635;
      --accent: #00e5a0; --accent2: #ff6b6b; --accent3: #ffd166;
      --accent4: #74b9ff;
      --text: #e8f4f8; --muted: #7a9bb5; --radius: 18px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg); font-family: 'Nunito', sans-serif;
      color: var(--text); min-height: 100vh; padding: 2rem 1rem 5rem; overflow-x: hidden;
    }
    body::before {
      content: ''; position: fixed; top: -200px; left: -200px; width: 600px; height: 600px;
      background: radial-gradient(circle, rgba(0,229,160,0.07) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }
    body::after {
      content: ''; position: fixed; bottom: -150px; right: -150px; width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(116,185,255,0.07) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }
    .container { max-width: 780px; margin: 0 auto; position: relative; z-index: 1; }

    /* â”€â”€ NAME SCREEN â”€â”€ */
    #nameScreen {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; min-height: 60vh; padding: 3rem 1rem;
      animation: fadeIn 0.5s ease;
    }
    .name-card {
      background: var(--card); border: 1px solid rgba(0,229,160,0.25);
      border-radius: var(--radius); padding: 2.5rem 2.5rem 2rem;
      max-width: 440px; width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 40px rgba(0,229,160,0.08);
      text-align: center;
    }
    .name-icon { font-size: 3rem; margin-bottom: 1rem; display: block; }
    .name-title {
      font-family: 'Baloo 2', cursive; font-size: 1.7rem; font-weight: 800;
      background: linear-gradient(135deg, #fff 30%, var(--accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 0.3rem;
    }
    .name-subtitle { color: var(--muted); font-size: 0.9rem; font-weight: 600; margin-bottom: 1.8rem; line-height: 1.5; }
    .name-label {
      display: block; font-size: 0.82rem; font-weight: 800;
      letter-spacing: 0.08em; text-transform: uppercase;
      color: var(--accent); text-align: left; margin-bottom: 0.5rem;
    }
    #playerNameInput {
      width: 100%; background: rgba(255,255,255,0.06);
      border: 2px solid rgba(255,255,255,0.12); border-radius: 12px;
      color: var(--text); font-family: 'Baloo 2', cursive;
      font-size: 1.2rem; font-weight: 700; text-align: center;
      padding: 0.5rem 1rem; outline: none; margin-bottom: 1.8rem;
      transition: border-color 0.25s, background 0.25s;
    }
    #playerNameInput::placeholder { color: var(--muted); font-size: 1rem; font-weight: 400; }
    #playerNameInput:focus { border-color: var(--accent); background: rgba(0,229,160,0.07); }
    #startBtn {
      font-family: 'Baloo 2', cursive; font-size: 1.1rem; font-weight: 700;
      background: var(--accent); color: #0f1923; border: none;
      border-radius: 50px; padding: 0.8rem 2.5rem; cursor: pointer;
      box-shadow: 0 6px 24px rgba(0,229,160,0.3);
      transition: transform 0.15s, box-shadow 0.15s;
    }
    #startBtn:hover { transform: translateY(-2px); box-shadow: 0 10px 32px rgba(0,229,160,0.4); }

    /* â”€â”€ MAIN CONTENT â”€â”€ */
    #mainContent { display: none; }
    #mainContent.show { display: block; animation: fadeIn 0.4s ease; }

    /* HEADER */
    header { text-align: center; margin-bottom: 1.8rem; animation: fadeDown 0.6s ease both; }
    .badge {
      display: inline-block; background: rgba(0,229,160,0.15); border: 1px solid rgba(0,229,160,0.35);
      color: var(--accent); font-size: 0.78rem; font-weight: 800; letter-spacing: 0.12em;
      text-transform: uppercase; padding: 0.35rem 1rem; border-radius: 50px; margin-bottom: 1rem;
    }
    h1 {
      font-family: 'Baloo 2', cursive; font-size: clamp(1.8rem, 5vw, 2.8rem);
      font-weight: 800; line-height: 1.1;
      background: linear-gradient(135deg, #fff 30%, var(--accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 0.6rem;
    }
    .subtitle { color: var(--muted); font-size: 1rem; font-weight: 600; }
    .header-student {
      margin-top: 0.4rem; font-size: 0.92rem; font-weight: 700;
      color: var(--muted);
    }
    .header-student em { color: var(--accent); font-style: normal; }

    /* SCORE STAMP */
    .score-stamp {
      display: inline-flex; flex-direction: column; align-items: center;
      justify-content: center;
      width: 84px; height: 84px; border-radius: 50%;
      border: 3px solid rgba(0,229,160,0.5);
      color: var(--accent); font-family: 'Baloo 2', cursive;
      position: absolute; top: 0; right: 0;
      transition: all 0.3s ease;
    }
    .score-stamp .stamp-label { font-size: 0.55rem; font-weight: 800; letter-spacing: 0.1em; text-transform: uppercase; opacity: 0.7; }
    .score-stamp .stamp-score { display: flex; align-items: baseline; gap: 1px; }
    .score-stamp .stamp-num { font-size: 2rem; font-weight: 800; line-height: 1; transition: all 0.3s ease; }
    .score-stamp .stamp-denom { font-size: 0.85rem; font-weight: 700; opacity: 0.6; }
    @keyframes stampBump { 0%{transform:scale(1)} 40%{transform:scale(1.2)} 100%{transform:scale(1)} }
    .score-stamp.bump { animation: stampBump 0.4s ease; }

    /* PROGRESS DOTS */
    #progressSection {
      background: var(--card); border: 1px solid rgba(255,255,255,0.07);
      border-radius: var(--radius); padding: 1.2rem 1.5rem; margin-bottom: 1.5rem;
      animation: fadeDown 0.6s 0.05s ease both;
    }
    .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.9rem; }
    .progress-label { font-size: 0.8rem; font-weight: 800; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); }
    #progressCount { font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700; color: var(--accent); }
    #dotsGrid { display: flex; flex-wrap: wrap; gap: 8px; }
    .dot-ball {
      width: 22px; height: 22px; border-radius: 50%;
      background: rgba(255,255,255,0.06); border: 2px solid rgba(255,255,255,0.12);
      transition: background 0.4s, border-color 0.4s, box-shadow 0.4s;
      position: relative;
    }
    .dot-ball.done {
      background: var(--accent); border-color: var(--accent); box-shadow: 0 0 8px rgba(0,229,160,0.5);
    }
    .dot-ball.done::after {
      content: 'âœ“'; position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; color: #0f1923; font-weight: 900;
    }
    .dot-ball.pop { animation: popDot 0.4s ease; }

    /* INSTRUCTIONS */
    .instructions {
      background: var(--card); border: 1px solid rgba(255,209,102,0.25);
      border-left: 4px solid var(--accent3); border-radius: var(--radius);
      padding: 1.2rem 1.5rem; margin-bottom: 1.5rem;
      display: flex; align-items: flex-start; gap: 0.9rem;
      animation: fadeDown 0.6s 0.1s ease both;
    }
    .instructions .icon { font-size: 1.5rem; flex-shrink: 0; margin-top: 0.1rem; }
    .instructions p { color: #c8dde8; font-size: 0.97rem; line-height: 1.6; }

    /* ROUND LABEL */
    #roundLabel {
      text-align: center; margin-bottom: 1rem;
      font-family: 'Baloo 2', cursive; font-size: 0.95rem; font-weight: 700;
      color: var(--muted); letter-spacing: 0.04em;
    }

    /* CARDS */
    .exercises { display: flex; flex-direction: column; gap: 1.4rem; }
    .card {
      background: var(--card); border: 1px solid rgba(255,255,255,0.07);
      border-radius: var(--radius); padding: 1.6rem 1.8rem;
      position: relative; overflow: hidden;
      transition: border-color 0.3s, transform 0.2s, background 0.3s;
    }
    .card:hover { transform: translateY(-2px); border-color: rgba(255,255,255,0.15); }
    .card.correct { border-color: rgba(0,229,160,0.5); background: linear-gradient(135deg, #1a2635, #1a2e2a); }
    .card.wrong   { border-color: rgba(255,107,107,0.5); background: linear-gradient(135deg, #1a2635, #2e1a1a); }

    .card-num {
      position: absolute; top: 1.2rem; right: 1.5rem;
      font-family: 'Baloo 2', cursive; font-size: 2.5rem; font-weight: 800;
      color: rgba(255,255,255,0.04); line-height: 1; user-select: none;
    }

    .card-tag-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.9rem; }
    .card-tag {
      display: inline-block; font-size: 0.7rem; font-weight: 800;
      letter-spacing: 0.1em; text-transform: uppercase;
      padding: 0.2rem 0.7rem; border-radius: 50px;
    }
    .card-difficulty { font-size: 0.8rem; color: var(--accent3); letter-spacing: 0.05em; }

    /* tag colours cycle */
    .card:nth-child(3n+1) .card-tag { background: rgba(0,229,160,0.15);   color: var(--accent);  }
    .card:nth-child(3n+2) .card-tag { background: rgba(255,209,102,0.15); color: var(--accent3); }
    .card:nth-child(3n+3) .card-tag { background: rgba(116,185,255,0.15); color: var(--accent4); }
    .card.wrong   .card-tag { background: rgba(255,107,107,0.15); color: var(--accent2); }
    .card.correct .card-tag { background: rgba(0,229,160,0.15);   color: var(--accent);  }

    .sentence {
      font-size: 1.05rem; font-weight: 600; color: var(--text);
      line-height: 2.2; margin-bottom: 0.8rem;
      display: flex; flex-wrap: wrap; align-items: center; gap: 0.4rem;
    }

    input[type="text"] {
      width: 90px; background: rgba(255,255,255,0.07);
      border: 2px solid rgba(255,255,255,0.15); border-radius: 10px;
      color: var(--text); font-family: 'Baloo 2', cursive;
      font-size: 1rem; font-weight: 700; text-align: center;
      padding: 0.35rem 0.5rem; outline: none;
      transition: border-color 0.25s, background 0.25s, box-shadow 0.25s;
    }
    input[type="text"]:focus {
      border-color: var(--accent); background: rgba(0,229,160,0.08);
      box-shadow: 0 0 0 3px rgba(0,229,160,0.12);
    }
    input.correct-input { border-color: var(--accent);  background: rgba(0,229,160,0.12); color: var(--accent); }
    input.wrong-input   { border-color: var(--accent2); background: rgba(255,107,107,0.12); color: var(--accent2); }
    input:disabled { opacity: 0.85; cursor: default; }

    /* HINT */
    .hint {
      font-size: 0.82rem; color: var(--accent3); font-weight: 700;
      margin-top: 0.6rem; padding: 0;
      background: rgba(255,209,102,0.08); border-left: 3px solid var(--accent3);
      border-radius: 6px;
      max-height: 0; overflow: hidden; opacity: 0;
      transition: max-height 0.35s ease, opacity 0.35s ease, padding 0.35s ease;
    }
    .hint.visible { max-height: 120px; opacity: 1; padding: 0.45rem 0.8rem; }

    .feedback {
      margin-top: 0.7rem; font-size: 0.9rem; font-weight: 700;
      min-height: 1.4rem; opacity: 0; transform: translateY(6px);
      transition: opacity 0.3s, transform 0.3s;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .feedback.show { opacity: 1; transform: translateY(0); }
    .feedback.ok   { color: var(--accent); }
    .feedback.err  { color: var(--accent2); }

    /* BUTTONS */
    .btn-row { margin-top: 2.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.8rem; }
    #checkBtn {
      font-family: 'Baloo 2', cursive; font-size: 1.1rem; font-weight: 700;
      background: var(--accent); color: #0f1923; border: none;
      border-radius: 50px; padding: 0.85rem 2.8rem; cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 6px 24px rgba(0,229,160,0.3);
    }
    #checkBtn:hover  { transform: translateY(-2px); box-shadow: 0 10px 32px rgba(0,229,160,0.4); }
    #checkBtn:active { transform: scale(0.97); }
    #checkBtn:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }

    #scoreBox {
      text-align: center; font-family: 'Baloo 2', cursive; font-size: 1.1rem; font-weight: 800;
      opacity: 0; transform: translateY(10px); transition: opacity 0.4s, transform 0.4s;
    }
    #scoreBox.show { opacity: 1; transform: translateY(0); }
    #scoreBox .score-num { font-size: 2.2rem; color: var(--accent); display: block; }
    #scoreBox .score-msg { color: var(--muted); font-size: 0.95rem; font-weight: 600; margin-top: 0.2rem; }

    #retryBtn {
      display: none;
      font-family: 'Baloo 2', cursive; font-size: 0.95rem; font-weight: 700;
      background: transparent; color: var(--muted);
      border: 2px solid rgba(255,255,255,0.1); border-radius: 50px;
      padding: 0.6rem 2rem; cursor: pointer; transition: color 0.2s, border-color 0.2s;
    }
    #retryBtn:hover { color: var(--text); border-color: rgba(255,255,255,0.3); }

    /* CELEBRATION */
    #celebration {
      display: none; position: fixed; inset: 0; z-index: 999;
      background: rgba(10,20,30,0.88);
      justify-content: center; align-items: center; flex-direction: column; text-align: center;
    }
    #celebration.show { display: flex; animation: fadeIn 0.4s ease; }
    .celeb-inner {
      background: var(--card); border: 2px solid rgba(0,229,160,0.4);
      border-radius: 28px; padding: 3rem 2.5rem; max-width: 440px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 40px rgba(0,229,160,0.15);
    }
    .celeb-emoji { font-size: 4rem; margin-bottom: 1rem; display: block; animation: bounce 0.7s ease infinite alternate; }
    .celeb-name-txt { font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700; color: var(--muted); margin-bottom: 0.2rem; }
    .celeb-title { font-family: 'Baloo 2', cursive; font-size: 2rem; font-weight: 800; color: #fff; margin-bottom: 0.5rem; }
    .celeb-score-note { font-size: 0.9rem; font-weight: 700; color: var(--accent); margin-bottom: 0.3rem; }
    .celeb-sub   { color: var(--muted); font-size: 0.97rem; font-weight: 600; margin-bottom: 2rem; line-height: 1.5; }
    #celebCloseBtn {
      font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700;
      background: var(--accent); color: #0f1923; border: none;
      border-radius: 50px; padding: 0.8rem 2.2rem; cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 4px 18px rgba(0,229,160,0.35);
    }
    #celebCloseBtn:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,229,160,0.5); }

    /* CONFETTI */
    #confettiCanvas { position: fixed; inset: 0; z-index: 998; pointer-events: none; display: none; }
    #confettiCanvas.show { display: block; }

    /* FINAL */
    #finalScreen { display: none; text-align: center; padding: 3rem 1rem; }
    #finalScreen.show { display: block; animation: fadeUp 0.6s ease; }
    .final-inner {
      display: inline-block; background: var(--card);
      border: 2px solid rgba(0,229,160,0.3); border-radius: 28px;
      padding: 3rem 3rem 2.5rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 60px rgba(0,229,160,0.08);
    }
    .final-emoji { font-size: 5rem; display: block; margin-bottom: 1rem; }
    .final-name-txt { font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700; color: var(--muted); margin-bottom: 0.5rem; }
    .final-grade {
      width: 120px; height: 120px; border-radius: 50%;
      border: 4px solid var(--accent);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      margin: 0 auto 1rem;
      box-shadow: 0 0 30px rgba(0,229,160,0.25);
    }
    .final-grade .grade-num { font-family: 'Baloo 2', cursive; font-size: 3rem; font-weight: 800; color: var(--accent); line-height: 1; }
    .final-grade .grade-denom { font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700; color: var(--muted); }
    .final-title { font-family: 'Baloo 2', cursive; font-size: 2rem; font-weight: 800; color: #fff; }
    .final-sub { color: var(--muted); font-size: 0.97rem; font-weight: 600; margin: 0.5rem 0 0.8rem; line-height: 1.6; }
    .final-note { font-size: 0.8rem; color: var(--muted); margin-bottom: 1.5rem; font-style: italic; }
    #reloadBtn {
      font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700;
      background: transparent; color: var(--accent);
      border: 2px solid var(--accent); border-radius: 50px;
      padding: 0.75rem 2rem; cursor: pointer; transition: background 0.2s, color 0.2s;
    }
    #reloadBtn:hover { background: var(--accent); color: #0f1923; }

    /* KEYFRAMES */
    @keyframes fadeDown  { from{opacity:0;transform:translateY(-18px)} to{opacity:1;transform:translateY(0)} }
    @keyframes fadeUp    { from{opacity:0;transform:translateY(22px)}  to{opacity:1;transform:translateY(0)} }
    @keyframes fadeIn    { from{opacity:0} to{opacity:1} }
    @keyframes popDot    { 0%{transform:scale(1)} 50%{transform:scale(1.6)} 100%{transform:scale(1)} }
    @keyframes bounce    { from{transform:translateY(0)} to{transform:translateY(-12px)} }
  </style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- Celebration overlay -->
<div id="celebration">
  <div class="celeb-inner">
    <span class="celeb-emoji">ğŸ†</span>
    <div class="celeb-name-txt" id="celebName"></div>
    <div class="celeb-title">Perfecte! 3/3!</div>
    <div class="celeb-score-note" id="celebScoreNote"></div>
    <div class="celeb-sub" id="celebSub"></div>
    <button id="celebCloseBtn" onclick="nextRound()">SegÃ¼ent repte â†’</button>
  </div>
</div>

<div class="container">

  <!-- â”€â”€ NAME SCREEN â”€â”€ -->
  <div id="nameScreen">
    <div class="name-card">
      <span class="name-icon">ğŸ“</span>
      <div class="name-title">Rectes i Angles</div>
      <div class="name-subtitle">MatemÃ tiques Â· 1r ESO<br>Geometria bÃ sica: rectes, angles i figures 2D</div>
      <label class="name-label" for="playerNameInput">âœï¸ Escriu el teu nom:</label>
      <input type="text" id="playerNameInput" placeholder="El teu nom aquÃ­â€¦" maxlength="30" autocomplete="off">
      <button id="startBtn" onclick="startGame()">Comencem! â†’</button>
    </div>
  </div>

  <!-- â”€â”€ MAIN CONTENT â”€â”€ -->
  <div id="mainContent">

    <header>
      <div class="badge">ğŸ“ Geometria Â· 1r ESO</div>
      <h1>Rectes i Angles</h1>
      <p class="subtitle">Demostra el que saps! Omple els buits amb la resposta correcta.</p>
      <p class="header-student">Alumne/a: <em id="headerName"></em></p>
      <div class="score-stamp" id="scoreStamp">
        <div class="stamp-label">Nota</div>
        <div class="stamp-score">
          <div class="stamp-num" id="stampNum">0</div>
          <div class="stamp-denom">/30</div>
        </div>
      </div>
    </header>

    <div id="progressSection">
      <div class="progress-header">
        <span class="progress-label">â¬¤ ProgrÃ©s total</span>
        <span id="progressCount">0 / 30</span>
      </div>
      <div id="dotsGrid"></div>
    </div>

    <div class="instructions">
      <span class="icon">ğŸ’¡</span>
      <p>Omple els buits i fes clic a <strong>"Comprova respostes"</strong>. Si t'equivoques apareixerÃ  una pista, perÃ² <strong>no se't donarÃ  la resposta</strong>. Cada pregunta encertada a la primera suma <strong>1 punt</strong>. Pots reintentar les que has fallat sense perdre els encerts!</p>
    </div>

    <div id="roundLabel"></div>
    <div class="exercises" id="exercises"></div>

    <div class="btn-row">
      <button id="checkBtn" onclick="checkAnswers()">âœ… Comprova respostes</button>
      <div id="scoreBox">
        <span class="score-num" id="scoreNum"></span>
        <span class="score-msg" id="scoreMsg"></span>
      </div>
      <button id="retryBtn" onclick="retryRound()">ğŸ”„ Torna-ho a intentar</button>
    </div>

    <!-- Final screen -->
    <div id="finalScreen">
      <div class="final-inner">
        <span class="final-emoji">ğŸŒŸ</span>
        <div class="final-name-txt" id="finalName"></div>
        <div class="final-grade">
          <div class="grade-num" id="finalGradeNum">â€”</div>
          <div class="grade-denom">/ 30</div>
        </div>
        <div class="final-title" id="finalTitle">ExcelÂ·lent!</div>
        <div class="final-sub" id="finalSub"></div>
        <div class="final-note">* Cada pregunta encertada a la primera suma 1 punt. MÃ xim: 30 punts.</div>
        <button id="reloadBtn" onclick="location.reload()">Tornar a comenÃ§ar ğŸ”„</button>
      </div>
    </div>

  </div><!-- /mainContent -->
</div><!-- /container -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BANK â€” 30 exercicis de Rectes i Angles Â· 1r ESO
//   s[]  â†’ parts de la frase:
//          string   = text pla
//          ['x']    = negreta
//          '_'      = camp d'entrada
//   stars: 1=â˜… fÃ cil, 2=â˜…â˜… mitjÃ , 3=â˜…â˜…â˜… complex
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BANK = [

  // â”€â”€ Elements bÃ sics de geometria â€” â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Elements bÃ sics", stars:1,
    s:['Un segment Ã©s la part d\'una recta entre dos punts. Si un segment mesura ',['12 cm'],' i el dividim en dues parts iguals, cada part mesura ','_',' cm.'],
    answer:6,
    hint:"Divideix 12 entre 2."
  },
  {
    tag:"Elements bÃ sics", stars:1,
    s:['Una recta s\'estÃ©n infinitament en ','_',' direccions (cap a cada extrem).'],
    answer:2,
    hint:"Una recta no tÃ© punts finals: va cap als dos costats."
  },
  {
    tag:"Elements bÃ sics", stars:1,
    s:['Un punt no tÃ© dimensions. Tres punts alineats defineixen ','_',' recta/es.'],
    answer:1,
    hint:"Per tres punts colÂ·lineals (alineats) passa exactament una recta."
  },
  {
    tag:"Elements bÃ sics", stars:1,
    s:['Per dos punts qualsevol passa exactament ','_',' recta.'],
    answer:1,
    hint:"Dos punts determineu una Ãºnica recta."
  },
  {
    tag:"Elements bÃ sics", stars:1,
    s:['Un segment de ',['20 cm'],' tÃ© el seu punt mig a ','_',' cm d\'un dels extrems.'],
    answer:10,
    hint:"El punt mig Ã©s a la meitat: 20 Ã· 2."
  },

  // â”€â”€ RelaciÃ³ entre rectes â€” â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"RelaciÃ³ rectes", stars:1,
    s:['Dues rectes paralÂ·leles mai es tallen. L\'angle que formen entre elles Ã©s de ','_',' graus (si les considerem en el mateix pla).'],
    answer:0,
    hint:"Les rectes paralÂ·leles mantenen sempre la mateixa distÃ ncia: no es tallen mai."
  },
  {
    tag:"RelaciÃ³ rectes", stars:1,
    s:['Dues rectes perpendiculars es tallen formant angles rectes de ','_','Â°.'],
    answer:90,
    hint:"Perpendicular = angle de 90Â°."
  },
  {
    tag:"RelaciÃ³ rectes", stars:1,
    s:['Dues rectes secants es tallen en ','_',' punt(s).'],
    answer:1,
    hint:"Dues rectes en un pla o no es tallen mai (paralÂ·leles) o es tallen en un sol punt."
  },
  {
    tag:"RelaciÃ³ rectes", stars:2,
    s:['Dues rectes paralÂ·leles tallen una secant. Els angles alterns interns formats son ','_','Â° si un d\'ells mesura 65Â°.'],
    answer:65,
    hint:"Els angles alterns interns entre rectes paralÂ·leles tallades per una secant sempre son iguals."
  },
  {
    tag:"RelaciÃ³ rectes", stars:2,
    s:['Una secant talla dues rectes paralÂ·leles. Un angle corresponent mesura 72Â°. L\'altre angle corresponent mesura ','_','Â°.'],
    answer:72,
    hint:"Els angles corresponents entre rectes paralÂ·leles tallades per una secant sÃ³n iguals."
  },

  // â”€â”€ Tipus d'angles â€” â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Tipus d'angles", stars:1,
    s:['Un angle de ','_','Â° Ã©s un angle recte.'],
    answer:90,
    hint:"Recte = 90Â° exactament."
  },
  {
    tag:"Tipus d'angles", stars:1,
    s:['Un angle agut Ã©s aquell que mesura menys de ','_','Â°.'],
    answer:90,
    hint:"Agut < 90Â° < obtÃºs."
  },
  {
    tag:"Tipus d'angles", stars:1,
    s:['Un angle obtÃºs mesura entre 90Â° i ','_','Â°.'],
    answer:180,
    hint:"ObtÃºs estÃ  entre 90Â° i 180Â°."
  },
  {
    tag:"Tipus d'angles", stars:1,
    s:['Un angle pla mesura ','_','Â°.'],
    answer:180,
    hint:"Un angle pla = mitja volta = 180Â°."
  },
  {
    tag:"Tipus d'angles", stars:1,
    s:['Un angle complet (volta sencera) mesura ','_','Â°.'],
    answer:360,
    hint:"Una volta completa = 360Â°."
  },

  // â”€â”€ Operacions amb angles â€” â˜…â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Operacions angles", stars:2,
    s:['Dos angles supplementaris sumen ','_','Â°. Si un mesura 65Â°, l\'altre mesura ','_','Â°.'],
    answer:115,
    hint:"Suplementaris sumen 180Â°. L'altre angle = 180 âˆ’ 65."
  },
  {
    tag:"Operacions angles", stars:2,
    s:['Dos angles complementaris sumen ','_','Â°. Si un mesura 38Â°, l\'altre mesura ','_','Â°.'],
    answer:52,
    hint:"Complementaris sumen 90Â°. L'altre angle = 90 âˆ’ 38."
  },
  {
    tag:"Operacions angles", stars:2,
    s:['Dos angles oposats pel vÃ¨rtex sempre son ','_','Â°. Si un d\'ells mesura 47Â°, l\'oposat mesura ','_','Â°.'],
    answer:47,
    hint:"Els angles oposats pel vÃ¨rtex sempre sÃ³n iguals."
  },
  {
    tag:"Operacions angles", stars:2,
    s:['Si un angle mesura 120Â°, el seu angle supplementari mesura ','_','Â°.'],
    answer:60,
    hint:"Suplementaris: 180 âˆ’ 120 = ?"
  },
  {
    tag:"Operacions angles", stars:2,
    s:['Tres angles d\'un triangle sumen sempre ','_','Â°.'],
    answer:180,
    hint:"La suma dels angles interiors de qualsevol triangle Ã©s sempre 180Â°."
  },
  {
    tag:"Operacions angles", stars:2,
    s:['La suma dels angles interiors d\'un quadrilÃ ter Ã©s sempre ','_','Â°.'],
    answer:360,
    hint:"Un quadrilÃ ter (4 costats) sempre tÃ© angles interiors que sumen 360Â°."
  },
  {
    tag:"Operacions angles", stars:2,
    s:['Si un angle Ã©s de 35Â°, el seu angle complementari Ã©s de ','_','Â°.'],
    answer:55,
    hint:"Complementaris: 90 âˆ’ 35 = ?"
  },

  // â”€â”€ Angles a les figures 2D â€” â˜…â˜… / â˜…â˜…â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    tag:"Angles a figures", stars:2,
    s:['En un triangle equilÃ ter, tots els angles son iguals. Cada angle mesura ','_','Â°.'],
    answer:60,
    hint:"Suma dels angles = 180Â°, i els tres son iguals: 180 Ã· 3."
  },
  {
    tag:"Angles a figures", stars:2,
    s:['En un triangle isÃ²sceles, dos angles de la base mesuren 50Â° cadascun. L\'angle del vÃ¨rtex mesura ','_','Â°.'],
    answer:80,
    hint:"Suma dels angles = 180Â°. Angle vÃ¨rtex = 180 âˆ’ 50 âˆ’ 50."
  },
  {
    tag:"Angles a figures", stars:2,
    s:['En un quadrat, cada angle interior mesura ','_','Â°.'],
    answer:90,
    hint:"360Â° Ã· 4 costats = 90Â° per angle. Un quadrat tÃ© 4 angles rectes."
  },
  {
    tag:"Angles a figures", stars:2,
    s:['En un triangle rectangle, un dels angles Ã©s de 90Â° i un altre de 35Â°. El tercer angle mesura ','_','Â°.'],
    answer:55,
    hint:"180 âˆ’ 90 âˆ’ 35 = ?"
  },
  {
    tag:"Angles a figures", stars:3,
    s:['La suma dels angles interiors d\'un hexÃ gon regular (6 costats) Ã©s ','_','Â°.'],
    answer:720,
    hint:"FÃ³rmula: (n âˆ’ 2) Ã— 180Â°. Per n = 6: (6 âˆ’ 2) Ã— 180."
  },
  {
    tag:"Angles a figures", stars:3,
    s:['Cada angle interior d\'un hexÃ gon regular mesura ','_','Â°.'],
    answer:120,
    hint:"Suma total = 720Â°. Divideix entre 6 angles iguals."
  },
  {
    tag:"Angles a figures", stars:3,
    s:['En un pentÃ gon regular (5 costats), la suma dels angles interiors Ã©s ','_','Â°.'],
    answer:540,
    hint:"FÃ³rmula: (n âˆ’ 2) Ã— 180Â°. Per n = 5: (5 âˆ’ 2) Ã— 180."
  },
  {
    tag:"Angles a figures", stars:3,
    s:['Cada angle interior d\'un pentÃ gon regular mesura ','_','Â°.'],
    answer:108,
    hint:"Suma total = 540Â°. Divideix entre 5 angles iguals."
  },
  {
    tag:"Angles a figures", stars:3,
    s:['En un triangle, un angle Ã©s el doble de l\'altre, i el tercer Ã©s de 60Â°. L\'angle major mesura ','_','Â°.'],
    answer:80,
    hint:"Si els dos angles desconeguts son x i 2x: x + 2x + 60 = 180. Llavors 3x = 120, x = 40, i l'angle major = 2x."
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TOTAL = 30, PER = 3;
let order = [], solved = 0, score = 0, roundIdx = 0;
let currentEx = [], checked = false;
let canScore = [true, true, true];
let locked   = [false, false, false];
let playerName = '';

const STARS = ['', 'â˜…', 'â˜…â˜…', 'â˜…â˜…â˜…'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOM I INICI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('playerNameInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') startGame();
});

function startGame() {
  const raw = document.getElementById('playerNameInput').value.trim();
  playerName = raw || 'Alumne/a';
  document.getElementById('nameScreen').style.display  = 'none';
  document.getElementById('mainContent').classList.add('show');
  document.getElementById('headerName').textContent = playerName;
  init();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  order = [...Array(TOTAL).keys()];
  for (let i = TOTAL - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [order[i], order[j]] = [order[j], order[i]];
  }
  buildDots();
  loadRound(0, false);
}

function buildDots() {
  const g = document.getElementById('dotsGrid');
  g.innerHTML = '';
  for (let i = 0; i < TOTAL; i++) {
    const d = document.createElement('div');
    d.className = 'dot-ball'; d.id = 'dot' + i;
    g.appendChild(d);
  }
  updateCount();
}

function updateCount() {
  document.getElementById('progressCount').textContent = solved + ' / ' + TOTAL;
  document.getElementById('stampNum').textContent = score;
}

function markDots(indices) {
  indices.forEach((gi, delay) => {
    setTimeout(() => {
      const el = document.getElementById('dot' + gi);
      if (!el) return;
      el.classList.add('done', 'pop');
      el.addEventListener('animationend', () => el.classList.remove('pop'), { once: true });
    }, delay * 180);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARREGAR REPTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadRound(ri, animate) {
  checked  = false;
  canScore = [true, true, true];
  locked   = [false, false, false];
  roundIdx = ri;

  const start = ri * PER;
  currentEx = order.slice(start, start + PER).map(i => BANK[i]);

  document.getElementById('roundLabel').textContent =
    'Repte ' + (ri + 1) + ' de ' + (TOTAL / PER);

  document.getElementById('scoreBox').classList.remove('show');
  document.getElementById('scoreNum').textContent = '';
  document.getElementById('scoreMsg').textContent = '';
  document.getElementById('retryBtn').style.display = 'none';
  document.getElementById('checkBtn').disabled = false;
  document.getElementById('checkBtn').style.display = '';

  const container = document.getElementById('exercises');

  function renderCards() {
    container.innerHTML = '';
    currentEx.forEach((ex, i) => {
      const card = document.createElement('div');
      card.className = 'card'; card.id = 'card' + i;

      let sentHTML = '';
      ex.s.forEach(part => {
        if (part === '_') {
          sentHTML += '<input type="text" id="ans' + i +
            '" placeholder="?" autocomplete="off" maxlength="12">';
        } else if (Array.isArray(part)) {
          sentHTML += '<strong>' + part[0] + '</strong>';
        } else {
          sentHTML += part;
        }
      });

      card.innerHTML =
        '<div class="card-num">' + (i + 1) + '</div>' +
        '<div class="card-tag-row">' +
          '<div class="card-tag">' + ex.tag + '</div>' +
          '<div class="card-difficulty">' + (STARS[ex.stars || 1]) + '</div>' +
        '</div>' +
        '<div class="sentence">' + sentHTML + '</div>' +
        '<div class="hint" id="hint' + i + '">ğŸ“ ' + ex.hint + '</div>' +
        '<div class="feedback" id="fb' + i + '"></div>';

      container.appendChild(card);

      card.style.opacity = '0';
      card.style.transform = 'translateX(50px)';
      setTimeout(() => {
        card.style.transition = 'opacity 0.35s ease, transform 0.35s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateX(0)';
      }, 60 + i * 90);
    });

    currentEx.forEach((_, i) => {
      document.getElementById('ans' + i).addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          let next = i + 1;
          while (next < PER && locked[next]) next++;
          const nxt = next < PER ? document.getElementById('ans' + next) : null;
          if (nxt) nxt.focus(); else checkAnswers();
        }
      });
    });

    setTimeout(() => {
      const f = document.getElementById('ans0');
      if (f && !locked[0]) f.focus();
    }, 350);
  }

  if (animate && container.children.length > 0) {
    Array.from(container.children).forEach((card, i) => {
      card.style.transition = 'opacity 0.28s ease, transform 0.28s ease';
      card.style.transitionDelay = (i * 50) + 'ms';
      card.style.opacity = '0';
      card.style.transform = 'translateX(-55px)';
    });
    setTimeout(renderCards, 340);
  } else {
    renderCards();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPROVA â€” puntuaciÃ³ per exercici individual
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkAnswers() {
  if (checked) return;
  const TOL = 0.5; // tolerÃ ncia 0.5 per a respostes enters d'angles
  let okThisAttempt = 0;
  let scoreGained   = 0;
  let allDone       = true;

  currentEx.forEach((ex, i) => {
    if (locked[i]) { okThisAttempt++; return; }

    const inp  = document.getElementById('ans'  + i);
    const fb   = document.getElementById('fb'   + i);
    const card = document.getElementById('card' + i);
    const hint = document.getElementById('hint' + i);
    const val  = parseFloat(inp.value.replace(',', '.').replace(/\s/g, ''));

    if (isNaN(val)) {
      inp.classList.remove('correct-input', 'wrong-input');
      card.classList.remove('correct', 'wrong');
      fb.className = 'feedback err show';
      fb.textContent = 'âœ— Escriu un nÃºmero.';
      hint.classList.add('visible');
      allDone = false;
      canScore[i] = false;
      return;
    }

    if (Math.abs(val - ex.answer) <= TOL) {
      okThisAttempt++;
      locked[i] = true;
      inp.classList.add('correct-input'); inp.classList.remove('wrong-input');
      inp.disabled = true;
      card.classList.add('correct'); card.classList.remove('wrong');
      fb.className = 'feedback ok show';
      const bonus = canScore[i] ? ' (+1 punt)' : '';
      fb.textContent = 'âœ“ Correcte!' + bonus;
      hint.classList.remove('visible');
      if (canScore[i]) scoreGained++;
    } else {
      allDone = false;
      canScore[i] = false;
      inp.classList.add('wrong-input'); inp.classList.remove('correct-input');
      card.classList.add('wrong'); card.classList.remove('correct');
      fb.className = 'feedback err show';
      fb.textContent = 'âœ— No Ã©s correcte. Revisa la pista!';
      hint.classList.add('visible');
    }
  });

  if (scoreGained > 0) {
    score += scoreGained;
    updateCount();
    const stamp = document.getElementById('scoreStamp');
    stamp.classList.remove('bump');
    void stamp.offsetWidth;
    stamp.classList.add('bump');
    stamp.addEventListener('animationend', () => stamp.classList.remove('bump'), { once: true });
  }

  const pendents = PER - okThisAttempt;
  let msg = '';
  if (allDone) {
    msg = 'Perfecte! Totes encertades! ğŸ†';
  } else if (pendents === 1) {
    msg = 'Queda 1 per corregir. Torna-ho a provar! ğŸ’ª';
  } else {
    msg = 'Queden ' + pendents + ' per corregir. Revisa les pistes! ğŸ’ª';
  }
  document.getElementById('scoreNum').textContent = okThisAttempt + ' / ' + PER;
  document.getElementById('scoreMsg').textContent = msg;
  document.getElementById('scoreBox').classList.add('show');

  if (allDone) {
    checked = true;
    document.getElementById('checkBtn').disabled = true;
    for (let i = 0; i < PER; i++) {
      const h = document.getElementById('hint' + i);
      if (h) h.classList.remove('visible');
    }
    const dotStart = roundIdx * PER;
    markDots(order.slice(dotStart, dotStart + PER));
    solved += PER;
    updateCount();

    const isLast = (roundIdx + 1) * PER >= TOTAL;
    if (isLast) setTimeout(showFinal, 800);
    else         setTimeout(showCelebration, 500);
  } else {
    document.getElementById('retryBtn').style.display = '';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RETRY â€” mantÃ© camps encertats blocats
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function retryRound() {
  for (let i = 0; i < PER; i++) {
    if (locked[i]) continue;
    const inp  = document.getElementById('ans'  + i);
    const fb   = document.getElementById('fb'   + i);
    const card = document.getElementById('card' + i);
    if (inp)  { inp.value = ''; inp.classList.remove('correct-input', 'wrong-input'); }
    if (card) card.classList.remove('correct', 'wrong');
    if (fb)   { fb.className = 'feedback'; fb.textContent = ''; }
  }
  document.getElementById('scoreBox').classList.remove('show');
  document.getElementById('retryBtn').style.display = 'none';
  document.getElementById('checkBtn').disabled = false;
  checked = false;
  for (let i = 0; i < PER; i++) {
    if (!locked[i]) { document.getElementById('ans' + i).focus(); break; }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CELEBRACIÃ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showCelebration() {
  document.getElementById('celebName').textContent = playerName + ',';
  document.getElementById('celebSub').textContent =
    'Repte ' + (roundIdx + 1) + ' superat! Prepara\'t per al repte ' + (roundIdx + 2) + '.';
  document.getElementById('celebScoreNote').textContent =
    'Nota acumulada: ' + score + ' / 30';
  document.getElementById('celebration').classList.add('show');
  launchConfetti();
}

function nextRound() {
  document.getElementById('celebration').classList.remove('show');
  stopConfetti();
  loadRound(roundIdx + 1, true);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FINAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showFinal() {
  document.getElementById('exercises').style.display  = 'none';
  document.getElementById('roundLabel').style.display = 'none';
  document.querySelector('.btn-row').style.display    = 'none';

  document.getElementById('finalName').textContent    = playerName;
  document.getElementById('finalGradeNum').textContent = score;

  const titles = [
    [0,  9,  'Segueix practicant! ğŸ’ª', 'No t\'amoÃ¯nis, la prÃ ctica fa la perfecciÃ³. Torna a intentar-ho!'],
    [10, 18, 'BÃ©, perÃ² pots millorar!', 'Has superat molts reptes. Amb una mica mÃ©s d\'esforÃ§ arribarÃ s al mÃ xim!'],
    [19, 26, 'Notable! ğŸ‰', 'Molt bon treball, ' + playerName + '! Quasi ho tens tot dominat.'],
    [27, 30, 'ExcelÂ·lent! ğŸ…', 'IncreÃ¯ble, ' + playerName + '! Domines la geometria de rectes i angles!'],
  ];
  const [,, title, sub] = titles.find(([min, max]) => score >= min && score <= max) || titles[3];
  document.getElementById('finalTitle').textContent = title;
  document.getElementById('finalSub').textContent   = sub;

  document.getElementById('finalScreen').classList.add('show');
  launchConfetti();
  setTimeout(stopConfetti, 6000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('confettiCanvas');
const ctx    = canvas.getContext('2d');
let particles = [], confettiAF = null;

function launchConfetti() {
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  canvas.classList.add('show');
  particles = Array.from({ length: 90 }, makeP);
  if (confettiAF) cancelAnimationFrame(confettiAF);
  (function loop() { drawConfetti(); confettiAF = requestAnimationFrame(loop); })();
}
function stopConfetti() {
  if (confettiAF) { cancelAnimationFrame(confettiAF); confettiAF = null; }
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  canvas.classList.remove('show');
}
function makeP() {
  const cols = ['#00e5a0','#ffd166','#ff6b6b','#74b9ff','#a29bfe','#fdcb6e'];
  return {
    x: Math.random() * window.innerWidth, y: Math.random() * -200,
    w: 8 + Math.random() * 8, h: 4 + Math.random() * 5,
    color: cols[Math.floor(Math.random() * cols.length)],
    speed: 2 + Math.random() * 4, angle: Math.random() * Math.PI * 2,
    spin: (Math.random() - 0.5) * 0.2, drift: (Math.random() - 0.5) * 1.5,
  };
}
function drawConfetti() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    p.y += p.speed; p.x += p.drift; p.angle += p.spin;
    if (p.y > canvas.height) Object.assign(p, makeP(), { y: -20 });
    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.angle);
    ctx.fillStyle = p.color; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();
  });
}
</script>
</body>
</html>
